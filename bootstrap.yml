- name: Bootstrap development environment
  hosts: localhost

  tasks:
    - name: Install cask packages with brew
      become: no
      community.general.homebrew_cask:
        name:
          - font-meslo-lg-nerd-font
          - wezterm
          - font-fira-code-nerd-font
          - font-symbols-only-nerd-font


    - name: Install regular packages with brew
      become: no
      community.general.homebrew:
        name:
          - git
          - tmux
          - nvim
          - lazygit
          - the_silver_searcher
          - ripgrep
          - stow
          - fzf
          - asdf
          - zsh-completions
          - direnv
          - sheldon
          - reattach-to-user-namespace
          - forgit
          - watchexec
          - just
          - yazi
          - ffmpegthumbnailer
          - unar
          - jq
          - poppler
          - fd
          - ripgrep
          - fzf
          - zoxide
          - rclone
        state: present
        upgrade_all: false
      when: ansible_distribution == "MacOSX"
 
    # Install fzf 
    - name: install fzf
      shell: 
        cmd: "$(brew --prefix)/opt/fzf/install"

    # Oh My tmux
    - name: Setup tmux
      become: no
      ansible.builtin.git:
        depth: 1
        dest: ~/.tmux
        repo: https://github.com/gpakosz/.tmux.git

    - name: Symlink tmux
      ansible.builtin.file:
        state: "link"
        src: ~/.tmux/.tmux.conf
        dest: ~/.tmux.conf

    - name: Run stow
      shell: 
        cmd: "stow {{ item }} --target {{ ansible_env.HOME }} --verbose=2"
      register: result
      changed_when: 'result.stderr is search("LINK: ")'
      loop: 
        - neovim
        - tmux
        - zsh
        - wezterm
